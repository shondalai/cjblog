var CjBlogApi={form_submitted:!1};
(function(a){CjBlogApi.init=function(){a('a[href="#adminForm"]').click(function(){var b=a(a(this).attr("href"));a("html,body").animate({scrollTop:b.offset().top},"slow")});a(".js-stools-btn-filter").click(function(){a(".js-stools-container-filters").toggle("slow")});a(".js-stools-btn-clear").click(function(){a("#filter_search").val("").closest("form").submit()});jQuery().tooltip&&(a("body").on("mouseover",'[data-toggle="tooltip"]',function(){a(this).tooltip("show")}),a("body").on("mouseover",'[data-toggle="popover"]',
function(){a(this).popover("show")}))};CjBlogApi.init_profile=function(){};CjBlogApi.init_article=function(){a("a.gallery").colorbox({photo:!0,maxWidth:800,maxHeight:600})};CjBlogApi.init_activity=function(){a(".commentbox").keydown(function(b){if(13==b.keyCode){var c=a(this);b=c.val();if(0==b.length)return!0;a.ajax({url:a("#url_save_comment").text(),type:"post",dataType:"json",data:{commentId:c.closest(".activity").find('input[name="commentId"]').val(),activtyId:c.closest(".activity").find('input[name="activityId"]').val(),
description:b},beforeSend:function(d){c.val("").prop("readonly",!0)}}).done(function(d){if(d.success&&d.data){0==c.closest(".activity").find(".comments").length&&c.closest(".activity").find(".panel-body").after(a("<ul>",{"class":"list-group comments"}));var e=a(a("#tmpl-comment").html().replace("{COMMENT_ID}",d.data.id));e.find(".comment").html(d.data.description);c.val("").closest(".activity").find(".comments").append(e)}else alert(d.message);c.prop("readonly",!1)}).fail(function(d){alert(d.message)})}});
a(".btn-load-comments").click(function(){var b=a(this);a.ajax({url:a("#url_load_comments").text(),type:"post",dataType:"json",data:{activtyId:b.closest(".activity").find('input[name="activityId"]').val(),start:b.closest(".activity").find('input[name="start"]').val()},beforeSend:function(c){b.parent().find("i").removeClass("fa-comments-o").addClass("fa-spinner fa-spin")}}).done(function(c){c.success&&c.data&&c.data.comments&&0!==c.data.comments.length?(1==c.data.start&&b.closest(".activity").find(".comments").empty(),
a.each(c.data.comments,function(d,e){d=a(a("#tmpl-comment").html().replace("{COMMENT_ID}",e.id));d.find(".comment").html(e.description);d.find(".profile-link").html(e.profile);d.find(".avatar").html(e.avatar);d.find(".activity-time").html(e.created);b.closest(".activity").find(".comments").prepend(d)}),b.closest(".activity").find('input[name="start"]').val(c.data.start),10>c.data.comments.length&&b.closest("table").remove()):b.closest("table").remove();b.parent().find("i").addClass("fa-comments-o").removeClass("fa-spinner fa-spin")}).fail(function(c){alert(c.message)})})};
CjBlogApi.init_form=function(){a(".attachments").on("click",".btn-attach-file",function(){a(this).closest(".attachment").find('input[type="file"]').change(function(){a(this).closest(".attachment").find(".filename").text(a(this).val())});a(this).closest(".attachment").find('input[type="file"]').click()});a(".attachments").on("change",'input[type="file"]:last',function(){a(this).closest(".attachments").find(".panel-body").append(a("#tpl-attachment").html());a(this).closest(".attachment").find(".btn-delete-attachment").show()});
a(".attachments").on("click",".btn-delete-attachment",function(){a(this).closest(".attachment").remove()})};CjBlogApi.init_profileform=function(){var b=a("#avatar-image");b.on("load",function(){b.guillotine({eventOnChange:"guillotinechange",width:256,height:256});b.guillotine("fit")});b.on("guillotinechange",function(c,d,e){a('input[name="avatar-coords"]').val(d.scale.toFixed(4)+","+d.angle+","+d.x+","+d.y+","+d.w+","+d.h)});a("#rotate_left").click(function(){b.guillotine("rotateLeft")});a("#rotate_right").click(function(){b.guillotine("rotateRight")});
a("#fit").click(function(){b.guillotine("fit")});a("#zoom_in").click(function(){b.guillotine("zoomIn")});a("#zoom_out").click(function(){b.guillotine("zoomOut")});a("#change_avatar").click(function(){a("#btn-select-avatar").click()});a("#btn-select-avatar").change(function(){var c=new FileReader;c.readAsDataURL(document.getElementById("btn-select-avatar").files[0]);c.onload=function(d){b.guillotine("remove");b.attr("src",d.target.result);b.on("load",function(){b.guillotine({eventOnChange:"guillotinechange",
width:256,height:256});b.guillotine("fit")})}})};CjBlogApi.onBeforeLike=function(b,c,d,e){c.find("i").attr("class","fa fa-spinner fa-spin");return!0};CjBlogApi.onAfterLike=function(b,c,d,e){c.find(".user-rating").text(e.data);c.closest(".user-ratings").find(".btn").removeClass("btn-success btn-danger");e=d="";switch(b){case "rating.tlike":case "rating.rlike":d="btn-success";e="fa fa-thumbs-o-up";break;case "rating.tdislike":case "rating.rdislike":d="btn-danger",e="fa fa-thumbs-o-down"}c.removeClass("btn-success btn-danger");
c.attr("class","btn btn-dislike btn-mini "+d).find("i").attr("class",e)};CjBlogApi.submitAjaxForm=function(b,c,d,e,h){var g=a(c),k=a(b);b=g.attr("action");g.find('input[name="task"]').val(d);a.ajax({type:"POST",url:b+(/\?/.test(b)?"&":"?")+"format=json",data:g.serialize(),dataType:"json",encode:!0,beforeSend:function(f){if(!CjBlogApi.executeFunctionByName(e,CjBlogApi,d,k,g,null))return!1}}).done(function(f){f.messages&&f.messages.message&&"undefined"!=typeof f.messages.message&&alert(f.messages.message);
f.success?CjBlogApi.executeFunctionByName(h,CjBlogApi,d,k,g,f):alert(f.message)}).fail(function(f){"undefined"!=typeof f.message&&alert(f.message)})};CjBlogApi.executeFunctionByName=function(b,c,d){d=[].slice.call(arguments).splice(2);for(var e=b.split("."),h=e.pop(),g=0;g<e.length;g++)c=c[e[g]];return c[h].apply(this,d)}})(jQuery);
jQuery(document).ready(function(a){a=a("#cjblog_pageid").val();CjBlogApi.init();"activity"!=a&&"activities"!=a||CjBlogApi.init_activity();"profile"==a&&(CjBlogApi.init_activity(),CjBlogApi.init_profile());"article"==a&&CjBlogApi.init_article();"form"==a&&CjBlogApi.init_form();"profileform"==a&&CjBlogApi.init_profileform()});
